<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Builder</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #111; color: #fff; }
    header { background: #222; padding: 20px; text-align: center; }
    select, button { font-size: 16px; padding: 8px; margin: 10px 5px; }
    .controls { display: flex; flex-direction: column; align-items: center; }
    .pitch-container { display: flex; justify-content: center; padding: 20px; background: #004400; }
    .pitch { border: 5px solid white; border-radius: 12px; width: 94%; max-width: 900px; height: 600px; background: #0a4d0a; display: flex; flex-direction: column; justify-content: space-evenly; }
    .player-row { display: flex; justify-content: center; gap: 10px; }
    .shirt { width: 80px; height: 80px; border-radius: 50%; border: 2px solid white; background-color: #7A263A; position: relative; }
    .shirt::after { content: "üëï"; font-size: 36px; position: absolute; top:50%; left:50%; transform: translate(-50%, -50%); }
    .selector { position: absolute; bottom: 0; width: 100%; background: rgba(255,255,255,0.9); border: none; font-size: 12px; }
    table { margin: 20px auto; width: 80%; border-collapse: collapse; background: #eee; color: #000; }
    th, td { border: 1px solid #888; padding: 8px 12px; text-align: center; }
    th { background: #ccc; }
  </style>
</head>
<body>
  <header>
    <div class="controls">
      <label for="teamSelect">Select Team:</label>
      <select id="teamSelect"></select>
      <label for="formationSelect">Formation:</label>
      <select id="formationSelect">
        <option>4-4-2</option><option>4-3-3</option><option>3-5-2</option>
        <option>4-2-3-1</option><option>4-1-4-1</option><option>3-4-3</option>
        <option>5-3-2</option><option>4-5-1</option><option>3-6-1</option><option>5-4-1</option>
      </select>
      <div>
        <button onclick="saveTeam()">üíæ Save</button>
        <button onclick="loadTeam()">üìÇ Load</button>
        <button onclick="screenshot()">üñºÔ∏è Screenshot</button>
      </div>
    </div>
  </header>
  <div class="pitch-container">
    <div id="pitch" class="pitch"></div>
  </div>
  <table id="squadTable">
    <thead><tr><th>#</th><th>Name</th><th>Position</th></tr></thead>
    <tbody></tbody>
  </table>
  <script>
    let teams = [], players = [];
    const formations = {"4-4-2":[1,4,4,2],"4-3-3":[1,4,3,3],"3-5-2":[1,3,5,2],"4-2-3-1":[1,4,2,3,1],"4-1-4-1":[1,4,1,4,1],"3-4-3":[1,3,4,3],"5-3-2":[1,5,3,2],"4-5-1":[1,4,5,1],"3-6-1":[1,3,6,1],"5-4-1":[1,5,4,1]};

    async function loadData() {
      const [tRes, pRes] = await Promise.all([fetch('teams.json'), fetch('players.json')]);
      teams = await tRes.json(); players = await pRes.json();
      const ts = document.getElementById('teamSelect'); ts.innerHTML = '';
      teams.forEach(t => ts.appendChild(new Option(t.team_name, t.team_name)));
      if (teams.length) ts.selectedIndex = 0;
      ts.addEventListener('change', updatePitch);
      document.getElementById('formationSelect').addEventListener('change', updatePitch);
      updatePitch();
    }

    function getPositionType(i, total) {
      if (i===0) return 'GK'; if (total===5) { if (i===1) return 'DEF'; if (i>1 && i<4) return 'MID'; return 'FWD'; }
      if (total===4) { if (i===1) return 'DEF'; if (i===2) return 'MID'; return 'FWD'; }
      if (total===3) { if (i===1) return 'DEF'; return 'FWD'; }
      return 'MID';
    }

    function updatePitch() {
      const team = document.getElementById('teamSelect').value;
      const form = document.getElementById('formationSelect').value;
      const td = teams.find(t=>t.team_name===team) || {};
      const pitch = document.getElementById('pitch'); pitch.innerHTML = '';
      pitch.style.backgroundColor = td.primary_color || '#0a4d0a';
      const tbody = document.querySelector('#squadTable tbody'); tbody.innerHTML = '';
      let num = 1;
      (formations[form]||[]).forEach((cnt,i)=>{
        const row = document.createElement('div'); row.className='player-row';
        const pos = getPositionType(i, formations[form].length);
        const opts = players.filter(p=>p.team===team && p.position===pos).sort((a,b)=>a.player_name.localeCompare(b.player_name));
        for(let j=0;j<cnt;j++){
          const shirt = document.createElement('div'); shirt.className='shirt';
          shirt.style.borderColor = td.secondary_color || '#fff';
          shirt.onclick = () => {};
          const sel = document.createElement('select'); sel.className='selector';
          sel.innerHTML = '<option value="">Select</option>' + opts.map(p=>`<option>${p.player_name}</option>`).join('');
          sel.onchange = () => {
            const tr = tbody.querySelector(`tr[data-num='${num}']`);
            if (sel.value) {
              if (tr) { tr.children[1].textContent = sel.value; tr.children[2].textContent = pos; }
              else { const r=document.createElement('tr'); r.dataset.num=num; r.innerHTML=`<td>${num}</td><td>${sel.value}</td><td>${pos}</td>`; tbody.appendChild(r);}  }
            else if (tr) tbody.removeChild(tr);
          };
          shirt.appendChild(sel); row.appendChild(shirt); num++; }
        pitch.appendChild(row);
      });
    }

    function saveTeam() {
      const data={team:document.getElementById('teamSelect').value, formation:document.getElementById('formationSelect').value, squad:Array.from(document.querySelectorAll('.selector')).map(s=>s.value)};
      localStorage.setItem('savedTeam', JSON.stringify(data)); alert('Saved');
    }
    function loadTeam(){ const d=JSON.parse(localStorage.getItem('savedTeam')||'{}'); if(d.squad){ document.getElementById('teamSelect').value=d.team; document.getElementById('formationSelect').value=d.formation; updatePitch(); setTimeout(()=>{document.querySelectorAll('.selector').forEach((s,i)=>{s.value=d.squad[i]||''; s.dispatchEvent(new Event('change'));});},50); }}
    function screenshot(){ alert("Use your device's screenshot feature."); }

    loadData();
  </script>
</body>
</html>

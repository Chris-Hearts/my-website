<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Builder</title>
  <link rel="icon" href="data:," />
  <style>
    :root {
      --shirt-size: 80px;
      --shirt-gap: 10px;
    }
    body { font-family: Arial, sans-serif; margin: 0; background-color: #111; color: #fff; }
    header { background-color: #222; padding: 20px; text-align: center; }
    .controls { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    .controls label, .controls select, .controls button { margin: 5px; }
    select { padding: 6px; border-radius: 4px; border: none; }
    button { font-size: 16px; padding: 8px 12px; border: none; border-radius: 4px; background-color: #444; color: #fff; cursor: pointer; }
    button:hover { background-color: #555; }
    .pitch-container { display: flex; justify-content: center; padding: 20px; background-color: #004400; }
    .pitch { border: 5px solid white; border-radius: 12px; width: 90%; max-width: 900px; height: auto; position: relative; background-color: #0a4d0a; display: flex; flex-direction: column; justify-content: space-evenly; padding: 10px; }
    .player-row { display: flex; flex-wrap: wrap; justify-content: center; gap: var(--shirt-gap); margin-bottom: var(--shirt-gap); }
    .shirt { width: var(--shirt-size); height: var(--shirt-size); border-radius: 50%; border: 2px solid white; display: flex; justify-content: center; align-items: center; font-weight: bold; box-shadow: 0 0 6px #000; background-size: cover; background-position: center; color: white; cursor: pointer; position: relative; flex: 0 0 auto; }
    .modal-backdrop { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; justify-content:center; align-items:center; padding: 10px; box-sizing: border-box; }
    .modal { background:#fff; color:#000; padding:20px; border-radius:8px; width:100%; max-width:300px; max-height:80%; overflow:auto; }
    .modal h3 { margin-top:0; }
    .modal ul { list-style:none; padding:0; margin:0; }
    .modal li { padding:8px; cursor:pointer; border-bottom:1px solid #ccc; }
    .modal li:hover { background:#eee; }
    table { margin: 20px auto; width: 90%; max-width: 600px; border-collapse: collapse; background-color: #eee; color: #000; }
    table, th, td { border: 1px solid #888; }
    th, td { padding: 8px 12px; text-align: center; }
    th { background-color: #ccc; }

    @media (max-width: 600px) {
      :root { --shirt-size: 60px; --shirt-gap: 6px; }
      .controls { flex-direction: column; }
      .pitch { padding: 5px; }
      table { width: 100%; font-size: 14px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="controls">
      <label for="teamSelect">Team:</label>
      <select id="teamSelect"></select>
      <label for="formationSelect">Formation:</label>
      <select id="formationSelect">
        <option>4-4-2</option>
        <option>4-3-3</option>
        <option>3-5-2</option>
        <option>4-2-3-1</option>
        <option>4-1-4-1</option>
        <option>3-4-3</option>
        <option>5-3-2</option>
        <option>4-5-1</option>
        <option>3-6-1</option>
        <option>5-4-1</option>
      </select>
      <button onclick="saveTeam()">ðŸ’¾ Save</button>
      <button onclick="loadTeam()">ðŸ“‚ Load</button>
    </div>
  </header>
  <div class="pitch-container">
    <div id="pitch" class="pitch"></div>
  </div>
  <table id="squadTable">
    <thead><tr><th>#</th><th>Name</th><th>Position</th></tr></thead>
    <tbody></tbody>
  </table>

  <script>
    let teams=[], players=[], selections={};
    const formations={"4-4-2":[1,4,4,2],"4-3-3":[1,4,3,3],"3-5-2":[1,3,5,2],"4-2-3-1":[1,4,2,3,1],"4-1-4-1":[1,4,1,4,1],"3-4-3":[1,3,4,3],"5-3-2":[1,5,3,2],"4-5-1":[1,4,5,1],"3-6-1":[1,3,6,1],"5-4-1":[1,5,4,1]};

    async function loadData(){
      [teams,players]=await Promise.all([
        fetch('teams.json').then(r=>r.json()),
        fetch('players.json').then(r=>r.json())
      ]);
      populateTeams();
    }

    function populateTeams(){
      const ts=document.getElementById('teamSelect'); ts.innerHTML='';
      teams.forEach(t=>ts.appendChild(new Option(t.team_name,t.team_name)));
      if(teams.length) ts.value=teams[0].team_name;
      ts.onchange=updatePitch;
      document.getElementById('formationSelect').onchange=updatePitch;
      updatePitch();
    }

    function getPositionType(i,total){
      if(i===0) return 'GK';
      if(total===5){ if(i===1) return 'DEF'; if(i===2||i===3) return 'MID'; if(i===4) return 'FWD'; }
      else if(total===4){ if(i===1) return 'DEF'; if(i===2) return 'MID'; if(i===3) return 'FWD'; }
      else if(total===3){ if(i===1) return 'DEF'; if(i===2) return 'FWD'; }
      return 'MID';
    }

    function updatePitch(){
      const team=document.getElementById('teamSelect').value;
      const form=document.getElementById('formationSelect').value;
      const td=teams.find(t=>t.team_name===team) || {};
      const pitch=document.getElementById('pitch');
      pitch.innerHTML='';
      pitch.style.backgroundColor = td.primary_color || '#0a4d0a';
      selections={};
      document.querySelector('#squadTable tbody').innerHTML='';
      const line=formations[form]||[];
      let num=1;
      line.forEach((cnt,i)=>{
        const row=document.createElement('div'); row.className='player-row';
        const pos=getPositionType(i,line.length);
        const opts = players.filter(p=>p.team===team && p.position===pos).map(p=>p.player_name);
        for(let j=0;j<cnt;j++){
          const shirt=document.createElement('div'); shirt.className='shirt';
          shirt.style.backgroundColor = td.primary_color;
          shirt.dataset.num = num;
          shirt.dataset.pos = pos;
          shirt.innerHTML = `<span>${num}</span>`;
          shirt.onclick = ()=> openModal(num,pos,opts);
          row.appendChild(shirt);
          num++;
        }
        pitch.appendChild(row);
      });
    }

    function openModal(num,pos,opts){
      const modalBg=document.createElement('div'); modalBg.className='modal-backdrop';
      const modal=document.createElement('div'); modal.className='modal';
      modal.innerHTML=`<h3>Select ${pos} #${num}</h3><ul>` + opts.map(o=>`<li>${o}</li>`).join('') + `</ul>`;
      modal.querySelectorAll('li').forEach(li=> li.onclick = ()=>{
        selections[num]={name: li.textContent, pos};
        document.body.removeChild(modalBg);
        refreshSelections();
      });
      modalBg.appendChild(modal);
      document.body.appendChild(modalBg);
    }

    function refreshSelections(){
      const tbody = document.querySelector('#squadTable tbody'); tbody.innerHTML='';
      const arr = Object.entries(selections).map(([num,sel]) => ({ num: +num, ...sel }));
      const order = { GK:1, DEF:2, MID:3, FWD:4 };
      arr.sort((a,b)=> order[a.pos]-order[b.pos] || a.num-b.num);
      arr.forEach(s=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${s.num}</td><td>${s.name}</td><td>${s.pos}</td>`;
        tbody.appendChild(tr);
        const shirt = document.querySelector(`.shirt[data-num='${s.num}']`);
        shirt.textContent='';
        const span = document.createElement('span'); span.textContent = s.name.split(' ').pop();
        shirt.appendChild(span);
      });
    }

    function saveTeam(){
      localStorage.setItem('savedTeam', JSON.stringify({
        team: document.getElementById('teamSelect').value,
        formation: document.getElementById('formationSelect').value,
        selections
      }));
      alert('Team saved!');
    }

    function loadTeam(){
      const saved = JSON.parse(localStorage.getItem('savedTeam') || '{}');
      if(saved.selections) {
        document.getElementById('teamSelect').value = saved.team;
        document.getElementById('formationSelect').value = saved.formation;
        updatePitch();
        setTimeout(()=>{ selections = saved.selections; refreshSelections(); }, 50);
      }
    }

    loadData();
  </script>
</body>
</html>

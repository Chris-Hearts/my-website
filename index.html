<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Builder</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #111; color: #fff; }
    header { background-color: #222; padding: 20px; text-align: center; }
    select, button { font-size: 16px; padding: 8px; margin: 10px; }
    .controls { display: flex; flex-direction: column; align-items: center; }
    .pitch-container { display: flex; flex-direction: column; align-items: center; padding: 20px; background-color: #004400; }
    .pitch {
      border: 5px solid white;
      border-radius: 12px;
      width: 90%;
      max-width: 900px;
      height: 600px;
      background-color: #0a4d0a;
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
    }
    .player-row { display: flex; justify-content: center; gap: 10px; }
    .shirt {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 2px solid white;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #7A263A;
      color: white;
      position: relative;
    }
    .shirt::after {
      content: "ðŸ‘•";
      font-size: 36px;
      position: absolute;
      pointer-events: none;
    }
    .shirt::after {
      content: "ðŸ‘•";
      font-size: 36px;
      position: absolute;
    }
    .selector { margin-top: 4px; font-size: 12px; width: 90%; }
    table { margin: 20px auto; width: 80%; border-collapse: collapse; background-color: #eee; color: #000; }
    table, th, td { border: 1px solid #888; }
    th, td { padding: 8px 12px; text-align: center; }
    th { background-color: #ccc; }
  </style>
</head>
<body>
  <header>
    <div class="controls">
      <label>Select Team:</label>
      <select id="teamSelect"></select>
      <label>Select Formation:</label>
      <select id="formationSelect">
        <option>4-4-2</option><option>4-3-3</option><option>3-5-2</option>
        <option>4-2-3-1</option><option>4-1-4-1</option><option>3-4-3</option>
        <option>5-3-2</option><option>4-5-1</option><option>3-6-1</option><option>5-4-1</option>
      </select>
      <button onclick="saveTeam()">Save</button>
      <button onclick="loadTeam()">Load</button>
    </div>
  </header>
  <div class="pitch-container">
    <div id="pitch" class="pitch"></div>
  </div>
  <table id="squadTable">
    <thead><tr><th>#</th><th>Name</th><th>Position</th></tr></thead>
    <tbody></tbody>
  </table>
  <script>
    let teams = [], players = [];
    const formations = {"4-4-2":[1,4,4,2],"4-3-3":[1,4,3,3],"3-5-2":[1,3,5,2],"4-2-3-1":[1,4,2,3,1],"4-1-4-1":[1,4,1,4,1],"3-4-3":[1,3,4,3],"5-3-2":[1,5,3,2],"4-5-1":[1,4,5,1],"3-6-1":[1,3,6,1],"5-4-1":[1,5,4,1]};

    async function loadData() {
      const [tRes, pRes] = await Promise.all([fetch('teams.json'), fetch('players.json')]);
      teams = await tRes.json(); players = await pRes.json();
      const ts = document.getElementById('teamSelect'); ts.innerHTML = '';
      teams.forEach(t => ts.appendChild(new Option(t.team_name, t.team_name)));
      if (teams.length) ts.value = teams[0].team_name;
      ts.addEventListener('change', updatePitch);
      document.getElementById('formationSelect').addEventListener('change', updatePitch);
      updatePitch();
    }

    function getPositionType(i, total) {
      if (i === 0) return 'GK';
      if (total === 5) { if (i===1) return 'DEF'; if (i>1 && i<4) return 'MID'; return 'FWD'; }
      if (total === 4) { if (i===1) return 'DEF'; if (i===2) return 'MID'; return 'FWD'; }
      if (total === 3) { if (i===1) return 'DEF'; return 'FWD'; }
      return 'MID';
    }

    function updatePitch() {
      const team = document.getElementById('teamSelect').value;
      const form = document.getElementById('formationSelect').value;
      const td = teams.find(t=>t.team_name===team) || {};
      const pitch = document.getElementById('pitch'); pitch.innerHTML='';
      pitch.style.backgroundColor = td.primary_color || '#0a4d0a';
      let num=1; document.querySelector('#squadTable tbody').innerHTML='';
      (formations[form]||[]).forEach((cnt,i)=>{
        const rowDiv = document.createElement('div'); rowDiv.className='player-row';
        const pos = getPositionType(i, formations[form].length);
        const opts = players.filter(p=>p.team===team && p.position===pos).sort((a,b)=>a.player_name.localeCompare(b.player_name));
        for(let j=0;j<cnt;j++){
          const shirt = document.createElement('div'); shirt.className='shirt';
          shirt.style.backgroundColor = td.primary_color; shirt.style.borderColor = td.secondary_color;
          const sel = document.createElement('select'); sel.className='selector';
          sel.innerHTML = '<option value="">Select</option>' + opts.map(p=>`<option>${p.player_name}</option>`).join('');
          sel.addEventListener('change', ()=>{
            const tb = document.querySelector('#squadTable tbody');
            const existing = tb.querySelector(`tr[data-num='${num}']`);
            if (sel.value) {
              if (existing) { existing.children[1].textContent = sel.value; existing.children[2].textContent = pos; }
              else { const tr=document.createElement('tr'); tr.dataset.num=num; tr.innerHTML=`<td>${num}</td><td>${sel.value}</td><td>${pos}</td>`; tb.appendChild(tr); }
            } else if (existing) { existing.remove(); }
          });
          const numDiv = document.createElement('div'); numDiv.textContent=num;
          shirt.append(numDiv, sel);
          rowDiv.appendChild(shirt); num++;
        }
        pitch.appendChild(rowDiv);
      });
    }

    function saveTeam(){
      const data={team:document.getElementById('teamSelect').value, formation:document.getElementById('formationSelect').value, squad:Array.from(document.querySelectorAll('.selector')).map(s=>s.value)};
      localStorage.setItem('savedTeam', JSON.stringify(data)); alert('Saved');
    }
    function loadTeam(){
      const data = JSON.parse(localStorage.getItem('savedTeam')||'{}');
      if (!data.squad) return alert('No saved');
      document.getElementById('teamSelect').value=data.team;
      document.getElementById('formationSelect').value=data.formation;
      updatePitch(); setTimeout(()=>{document.querySelectorAll('.selector').forEach((s,i)=>{s.value=data.squad[i]||''; s.dispatchEvent(new Event('change'));});},50);
    }

    loadData();
  </script>
</body>
</html>
